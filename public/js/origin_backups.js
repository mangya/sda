$(document).ready(function(){var t=1,a=!1;function e(t,e){a||$(".data-loader").show(),$.ajax({type:"GET",url:app_route+"?page="+t,dataType:"json",success:function(t){a=!1;var e=["name","date","size","type","download","delete"],n=t.backups.data,o=$(".list-view"),s="";Object.keys(n).length>0?$.each(n,function(t,a){s+='<tr class="clickable_row">\t\t\t\t\t\t\t<td class="text-center">'+(parseInt(t)+1)+"</td>",$.each(e,function(t,e){var n=a[e];"download"==e?s+='<td data-field-name="'+e+'">\t\t\t\t\t\t\t\t\t<a href="'+n+'" class="btn btn-success btn-xs" data-toggle="tooltip" data-placement="bottom" title="Download backup">\t\t\t\t\t\t\t\t\t\tDownload\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t</td>':"delete"==e?s+='<td data-field-name="'+e+'">\t\t\t\t\t\t\t\t\t<button class="btn btn-danger btn-xs delete-backup" data-toggle="tooltip" data-placement="bottom" title="Delete backup" data-href="'+n+'">\t\t\t\t\t\t\t\t\t\tDelete\t\t\t\t\t\t\t\t\t</button>\t\t\t\t\t\t\t\t</td>':"type"==e?"Database"==n?s+='<td data-field-name="'+e+'">\t\t\t\t\t\t\t\t\t\t<span class="label label-info">'+n+"</span>\t\t\t\t\t\t\t\t\t</td>":"Files"==n?s+='<td data-field-name="'+e+'">\t\t\t\t\t\t\t\t\t\t<span class="label label-warning">'+n+"</span>\t\t\t\t\t\t\t\t\t</td>":"Database + Files"==n&&(s+='<td data-field-name="'+e+'">\t\t\t\t\t\t\t\t\t\t<span class="label label-primary">'+n+"</span>\t\t\t\t\t\t\t\t\t</td>"):s+='<td data-field-name="'+e+'">'+n+"</td>"}),s+="</tr>"}):s+='<tr>\t\t\t\t\t\t<td colspan="'+(e.length+1)+'" class="no-data">No Backups Found</td>\t\t\t\t\t</tr>',$(o).find(".list-view-items").empty().append(s),$("#item-count").html(t.backups.total||"0"),$("#item-from").html(t.backups.from||"0"),$("#item-to").html(t.backups.to||"0"),$(".origin-pagination-content").empty().append(makePagination(t.backups)),$(".data-loader").hide()},error:function(t){$(".data-loader").hide(),notify(JSON.parse(t.responseText).message,"error")}})}e(t),$(".refresh-backups").on("click",function(){e(t=1)}),$("body").on("click",".delete-backup",function(){var t=$(this).data("href");msgbox("Sure you want to delete this backup permanently?",'<button type="button" class="btn btn-xs" data-dismiss="modal">No</button>\t\t\t<button type="button" class="btn btn-danger btn-xs confirm-delete-backup" data-href="'+t+'">Yes</button>')}),$("body").on("click",".confirm-delete-backup",function(){var n=$(this).data("href");$(this).button("loading"),$.ajax({type:"POST",url:n,dataType:"json",success:function(n){$("#message-box").modal("hide"),n.success?(a=!0,e(t)):notify(n.msg,"error")},error:function(t){$("#message-box").modal("hide"),notify(JSON.parse(t.responseText).message,"error")}})}),$("body").on("click",".create-backup",function(a){a.preventDefault();var n=this,o=$(this).data("href");$(this).button("loading"),$(".data-loader-full").show(),$.ajax({type:"POST",url:o,dataType:"json",success:function(a){$(n).button("reset"),$(".data-loader-full").hide(),a.success?(notify(a.msg,"info"),e(t)):notify(a.msg,"error")},error:function(t){$(n).button("reset"),$(".data-loader-full").hide(),notify(JSON.parse(t.responseText).message,"error")}})}),$("body").on("click",".origin-pagination a",function(a){a.preventDefault(),"#"!=$(this).attr("href")&&$(this).attr("href").indexOf("page=")>=0&&e(t=$(this).attr("href").split("page=")[1])}),$(window).on("hashchange",function(){if(window.location.hash){var t=window.location.hash.replace("#","");if(t==Number.NaN||t<=0)return!1;e(t)}})});
